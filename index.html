<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Manrope' rel='stylesheet'>
    <script src="/js/three.js"></script>
    <script src="/js/GLTFLoader.js"></script>
    <script src="/js/jQuery.js"></script>
    <title>front_test</title>
  </head>
  <body>
      <div class="header">
        <div class="header__container">
          <div class="header__title-top title title_small">front<span>_test</span></div>
          <div class="header__title title">Тестовое задание</div>
          <div class="header__subtitle title title_subtitle">Сверстайте эту страницу включая интерактивные элементы.</div>
        </div>
      </div> 

      <div class="content">
        <div class="content__container">
          <div class="content__block block-fox">
            <div id="fox_task" class="block-fox__fox"></div>
            <div class="block-fox__task task">Анимация: вращение вокруг своей оси автоматически, или с реакцией на мышку.</div>
          </div>

          <div class="content__block block-card">
            <div class="block-card__animation">
              <div class="block-card__birds1"><img src="/svg/birds1.svg"></div>
              <div class="block-card__card card">
                <div class="card__infinity"><img src="/svg/infinity.svg" alt="infinity"></div>
                <div class="card__title">Интерактивная карточка</div>
                <div class="card__info">Должна вращаться за мышкой</div>
                <button class="card_button button">
                  <img src="/svg/visibility.svg" class="button__image">
                  <div class="button__text">КНОПКА</div>
                </button>
              </div>  
              <div class="block-card__birds2"><img src="/svg/birds2.svg"></div>
            </div>
            <div class="block-card__task task">Анимация: карточка отклоняется по направлению к курсору. Верхний и нижний слой с птицами повторяет движение карточки с легким параллаксом</div>
          </div>
        </div>   
      </div>

  <!--<div class="form_task">
        <form action="#" method="post" enctype="multipart/form-data" class="form">
          <p class="form_title">Форма</p>
          <p class="form_info">Дополнительный текст ⏳</p>

          <select name="select">
            <option selected value="xxx">Выбор чего-то*</option>
            <option value="value1">Выбор1</option>
            <option value="value2">Выбор2</option>
            <option value="value3">Выбор3</option>
            <option value="value4">Выбор4</option>
            <option value="value5">Выбор5</option>
          </select>

        </form>
      </div>
      <div></div>

    </div>
  -->  
    <script> //fox animation script
      let scene = new THREE.Scene();

      let camera = new THREE.PerspectiveCamera(45, 630 / 640, 0.1, 1000)
      camera.position.y = 100; 
      camera.position.z = 300; 

      renderer = new THREE.WebGLRenderer({alpha: true, antialias: true});
      renderer.setClearColor(0x000000, 0);
      renderer.setSize(630, 640);
          
      renderer.domElement.setAttribute("class", "fox");
      fox_task.append(renderer.domElement);

      const aLight = new THREE.AmbientLight(0x404040, 1.2);
      scene.add(aLight);

      const pLight = new THREE.PointLight(0xffffff, 3);
      pLight.position.set(50, 300, 450);
      scene.add(pLight);

      let loader = new THREE.GLTFLoader();
      let obj = null;

      loader.load('/3d/fox.gltf', function(gltf) {
        obj = gltf;
        obj.scene.scale.set(1, 1, 1);
        scene.add(obj.scene);
      })

      function rotating() {

        requestAnimationFrame(rotating);

        if(obj) obj.scene.rotation.y += 0.03

        renderer.render(scene, camera);
      }

      rotating();
    </script>
    <script> //card animation script
      const card = document.querySelector(".card");
      const animation = document.querySelector(".block-card__animation")
      let cardCoord= card.getBoundingClientRect();
  
      let block = document.querySelector(".block-card");
      let blockCoord = block.getBoundingClientRect();
  
      let cardCenterX = cardCoord.left + (cardCoord.width / 2) - blockCoord.left; 
      let cardCenterY = cardCoord.top + (cardCoord.height / 2) - blockCoord.top; 
      
      const forCard = 40;
      const speed = 1;
      let positionX = 0; positionY = 0;
      let coordXprocent = 0; coordYprocent = 0;

      block.addEventListener('mousemove', function(e) {

        const blockWidth = block.offsetWidth;
        const blockHeight = block.offsetHeight;

        const coordX = e.pageX - blockWidth / 2;
        const coordY = e.pageY - blockHeight / 2;
        
        coordXprocent = coordX / blockWidth * 100;
        coordYprocent = coordY / blockHeight * 100;

        const distX = coordXprocent - positionX;
        const distY = coordYprocent - positionY;
        
        positionX = positionX + (distX * speed);
        positionY = positionY + (distY * speed);
        
        angle = Math.atan2(e.layerX - cardCenterX, cardCenterY) * 0.8;
        console.log(angle);
  
        card.style.transform = 'rotateY('+ angle + 'rad)';   
        //translate('+ positionX / forCard + '%,' + positionY / forCard +'%)  
      });  
    </script>
  </body>
</html>